# Onboarding Setup Guide

## Overview
This implementation adds required legal agreement checkboxes to the final bio step of the onboarding process, along with a modal component to display legal documents and an RPC function to handle onboarding completion.

## Database Setup

### 1. Legal Documents Table
Make sure you have the `legal_documents` table with the following structure:

```sql
CREATE TABLE public.legal_documents (
  id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  document_type TEXT NOT NULL,
  version TEXT NOT NULL,
  title TEXT NOT NULL,
  content TEXT NOT NULL,
  is_latest BOOLEAN DEFAULT FALSE,
  published_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW()
);
```

### 2. Sample Data
Insert sample legal documents:

```sql
-- Terms of Service
INSERT INTO public.legal_documents (
  document_type, 
  version, 
  title, 
  content, 
  is_latest, 
  published_at
) VALUES (
  'terms_of_service',
  '1.0',
  'Terms of Service',
  '<h1>Terms of Service</h1><p>Welcome to Quillaborn...</p>',
  true,
  NOW()
);

-- Privacy Policy
INSERT INTO public.legal_documents (
  document_type, 
  version, 
  title, 
  content, 
  is_latest, 
  published_at
) VALUES (
  'privacy_policy',
  '1.0',
  'Privacy Policy',
  '<h1>Privacy Policy</h1><p>Your privacy is important to us...</p>',
  true,
  NOW()
);
```

### 3. RPC Function
Run the SQL from `supabase_functions.sql` to create the `complete_onboarding` RPC function.

## Features Implemented

### 1. Legal Modal Component (`src/components/ui/LegalModal.tsx`)
- Reusable modal for displaying legal documents
- Shows document title, version, and HTML content
- Responsive design with proper scrolling
- Close button and backdrop click to close

### 2. Updated BioPage Component
- Added required checkboxes for Terms of Service and Privacy Policy
- Legal document links that fetch and display content in modal
- Form validation requiring both checkboxes to be checked
- Disabled buttons until legal agreements are accepted
- Calls `complete_onboarding` RPC function instead of direct database updates

### 3. RPC Function (`complete_onboarding`)
- Handles all database updates in a single transaction
- Updates bio, pronouns, and sets onboarding_complete flag
- Returns JSON response with success/error status
- Proper error handling and security

## Usage

1. **Legal Document Links**: Users can click on "Terms of Service" or "Privacy Policy" links to view the full documents in a modal.

2. **Required Agreements**: Both checkboxes must be checked before the user can complete onboarding.

3. **Form Validation**: The "Complete Onboarding" and "Skip for Now" buttons are disabled until both legal agreements are accepted.

4. **RPC Call**: When completing onboarding, the system calls the `complete_onboarding` RPC function instead of making direct database updates.

## Dependencies

- `@tailwindcss/typography` - Added for prose styling in the legal modal
- Existing Supabase client setup

## Security

- RPC function uses `SECURITY DEFINER` to run with elevated privileges
- Function only allows authenticated users to execute
- Proper error handling prevents information leakage 